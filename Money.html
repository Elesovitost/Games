<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>MONEY ‚Äì Zapla≈• p≈ôesnƒõ</title>
<style>
  :root{
    --green:#25a525;
    --red:#d63636;
    --ink:#222;
    --panel:#f7f7f9;
    --accent:#00bcd4;
  }
  *{box-sizing:border-box}
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    margin:0; padding:14px; color:var(--ink); background:#fff;
    text-align:center;
  }

  /* Top bar ‚Äì inspirov√°no ABC.html */
  .topbar{display:flex;flex-direction:column;align-items:center;gap:10px;margin-bottom:12px}
  .score{display:flex;gap:10px}
  .score-box{display:inline-flex;align-items:center;justify-content:center;width:90px;height:44px;
    border:2px solid #333;border-radius:12px;background:#fff;box-shadow:2px 2px 8px rgba(0,0,0,.12)}
  .good{color:var(--green);font-family:Impact,system-ui;font-size:24px}
  .bad{color:var(--red);font-family:Impact,system-ui;font-size:24px}

  /* Layout */
  .game{
    max-width:1100px;margin-inline:auto;display:grid;gap:16px;
    grid-template-columns: 1fr auto 1fr;
    align-items:start;
  }
  .seller, .table, .middle{
    background:var(--panel); border:2px solid #333; border-radius:16px;
    padding:14px; box-shadow:2px 2px 10px rgba(0,0,0,.12);
    min-height:220px;
  }

  /* Prodavaƒçka + bublina */
  .seller-wrap{position:relative;display:flex;gap:10px;align-items:flex-start;justify-content:center}
  .seller img{max-height:180px;border-radius:10px;border:2px solid #333}
  .bubble{
    position:absolute; top:-90px; left:60%; transform:translateX(-50%);
    background:#fff;border:2px solid #333;border-radius:16px;padding:10px 14px;min-width:140px;
    box-shadow:2px 2px 8px rgba(0,0,0,.15); font-weight:700
  }
	.bubble:after{
	  content:"";
	  position:absolute;
	  left:50%;
	  bottom:-14px;
	  transform:translateX(-50%);
	  border-left:10px solid transparent;
	  border-right:10px solid transparent;
	  border-top:14px solid #333;
	}
	.bubble:before{
	  content:"";
	  position:absolute;
	  left:50%;
	  bottom:-12px;
	  transform:translateX(-50%);
	  border-left:8px solid transparent;
	  border-right:8px solid transparent;
	  border-top:12px solid #fff;
	}
  .bubble .hint{font-weight:600}
  .price{font-size:28px;color:#000}

  /* ≈òada penƒõz */
  .money-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px}
  .money-btn{
    background:#fff;border:2px solid #333;border-radius:12px;padding:6px;cursor:pointer;
    box-shadow:1px 1px 6px rgba(0,0,0,.12);transition:transform .15s;
  }
  .money-btn:hover{transform:translateY(-2px)}
  .money-btn img{height:64px;display:block}
  .money-btn span{display:block;font-weight:700;font-size:12px}

  /* Prost≈ôedn√≠ panel s tlaƒç√≠tkem */
  .middle{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px}
  .pay{
    font-size:24px;font-weight:800;letter-spacing:1px;
    background:linear-gradient(#fff,#eee); border:2px solid #000; border-radius:14px;
    padding:12px 20px; cursor:pointer; box-shadow:2px 2px 8px rgba(0,0,0,.25);
    transition:transform .05s;
  }
  .pay:active{transform:scale(.98)}
  .small{
    font-size:14px; border:1px solid #000; background:#fff; border-radius:10px; padding:6px 10px; cursor:pointer
  }
  .msg{min-height:26px;font-weight:800}

  /* St≈Øl */
  .table{position:relative}
  .desk{
    border:3px dashed #666;border-radius:14px;min-height:180px;background:#fff;
    display:flex;flex-wrap:wrap;gap:8px;align-content:flex-start;justify-content:flex-start;
    padding:10px; text-align:left
  }
  .desk img{height:58px}
  .sum{position:absolute;right:10px;bottom:8px;font-weight:800}
  .sum{display:none !important}
  .removable{cursor:pointer;border-radius:10px;box-shadow:0 0 0 2px transparent;transition:box-shadow .15s}
  .removable:hover{box-shadow:0 0 0 2px var(--accent)}

  /* Fireworks & celebration */
  canvas#fw{position:fixed;inset:0;pointer-events:none;z-index:999}
  .celebrate{
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;
    z-index:998;pointer-events:none;font-size:64px;text-shadow:3px 3px 0 #0002
  }
  .celebrate.show{display:flex;animation:pop 0.9s ease-out}
  @keyframes pop{0%{transform:scale(.6);opacity:0}80%{transform:scale(1.05);opacity:1}100%{transform:scale(1)}}

  /* Responsivita */
  @media (max-width:950px){
    .game{grid-template-columns:1fr}
    .bubble{position:static;transform:none;margin:6px auto 0}
  }

  /* --- Medaile & poh√°ry (ABC styl) --- */
  #trophy-bar{ margin: 30px auto 20px auto; text-align: center; width: 100%; }
  #medals-container{ font-size: 40px; display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; }

  @keyframes medal-from-depth{
    0%{transform:translate(-50%,-50%) scale(5);opacity:0}
    95%{transform:translate(-50%,-50%) scale(0.8);opacity:1}
    100%{transform:translate(-50%,-50%) scale(1);opacity:1}
  }
  .medal.pop-in{animation:pop-in .2s ease-out}
  @keyframes shake{0%,100%{transform:translateX(0)}25%,75%{transform:translateX(-5px)}50%{transform:translateX(5px)}}
  .medal.shake{animation:shake .5s ease-in-out}
  .flash-effect{
    position:fixed;left:50%;top:50%;width:60px;height:60px;border-radius:50%;
    background:radial-gradient(circle,#fff 0%,rgba(255,255,255,0) 70%);
    pointer-events:none;transform:translate(-50%,-50%) scale(0);animation:flash .5s forwards;z-index:9999
  }
  @keyframes flash{0%{opacity:1;transform:translate(-50%,-50%) scale(0)}
  50%{opacity:1;transform:translate(-50%,-50%) scale(1)}
  100%{opacity:0;transform:translate(-50%,-50%) scale(1.5)}}

  /* --- NOV√â: Ikona po≈æadovan√©ho zbo≈æ√≠ & ko≈°√≠k --- */
  .req-icon{
    width: 120px; min-height: 120px;
    border: 2px dashed #aaa; border-radius: 16px; background:#fff;
    display:flex;align-items:center;justify-content:center;
    margin-right:8px; user-select:none;
  }
  .icon-emoji{ font-size: 24px; line-height: 1; filter: drop-shadow(2px 2px 0 rgba(0,0,0,.08)); }
  .icon-emoji.big{ font-size: 70px; }
  .basket{
    margin-top: 10px; border: 2px solid #333; background:#fff; border-radius: 14px;
    min-height: 88px; display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:flex-start;
    padding:8px 10px; text-align:left
  }
  .basket::before{ content:"N√°kup:"; font-weight:800; margin-right:8px; }
  @media (max-width:950px){
    .req-icon{ width: 88px; min-height: 88px; }
    .icon-emoji.big{ font-size: 100px; }
  }
</style>
</head>
<body>

<div id="gif-container" style="position:fixed;top:80px;left:50%;transform:translateX(-160px);z-index:999;display:none;">
  <img id="gif-animation" src="dance1.gif" style="height:100px;" />
</div>

<audio id="sound-correct" src="correct.mp3"></audio>
<audio id="sound-wrong"   src="wrong.mp3"></audio>
<audio id="sound-win"     src="win.mp3"></audio>
<audio id="sound-metal-fall" src="sound-metal-fall.mp3"></audio>
<audio id="sound-metal-fuse" src="sound-metal-fuse.mp3"></audio>

<div class="topbar">
  <div style="font-weight:700">SCORE</div>
  <div class="score">
    <div class="score-box"><span class="good" id="good">0</span></div>
    <div class="score-box"><span class="bad" id="bad">0</span></div>
  </div>
</div>

<div class="game">

  <!-- LEV√ù PANEL ‚Äì prodavaƒçka + v√Ωbƒõr penƒõz -->
  <section class="seller">
    <div class="seller-wrap">
      <!-- NOV√â: box pro velkou ikonu produktu -->
      <div id="reqIcon" class="req-icon" aria-label="po≈æadovan√© zbo≈æ√≠"></div>

      <img src="MONEY/Prodavaƒçka.jpg" alt="prodavaƒçka">

      <div class="bubble" id="bubble">
        <div class="price" id="need">‚Äì</div>
        <div class="hint">Zapla≈•te pros√≠m</div>
      </div>
    </div>

    <!-- NOV√â: ko≈°√≠k pod prodavaƒçkou -->
    <div class="basket" id="basket" aria-label="hotov√Ω n√°kup"></div>
  </section>

  <!-- ST≈òED ‚Äì tlaƒç√≠tka -->
  <section class="middle">
    <button class="pay" id="payBtn">PLAT√çM</button>
    <button class="small" id="undoBtn">‚Ü©Ô∏è Zpƒõt</button>
    <button class="small" id="clearBtn">üßπ Reset</button>
    <div class="msg" id="msg"></div>
  </section>

  <!-- PRAV√ù PANEL ‚Äì st≈Øl -->
  <section class="table">
    <div class="desk" id="desk"></div>
    <div class="sum" id="sum">0 Kƒç</div>
    <div class="money-row" id="moneyRow"></div>
  </section>

  <!-- Oh≈àostroj + ‚Äúoslava‚Äù -->
  <canvas id="fw"></canvas>
  <div class="celebrate" id="celebrate">üéâüéäü•≥</div>

  <!-- Doƒçasn√° ‚Äûvyskakovac√≠‚Äú ikona p≈ôi p≈ôid√°n√≠ -->
  <div id="medal-animation"
       style="position:fixed;top:-100px;left:50%;transform:translateX(-50%);font-size:80px;z-index:9999;pointer-events:none;display:none;"></div>
</div>

<!-- Medaile & poh√°ry (ABC) -->
<div id="trophy-bar">
  <h3 style="margin:6px 0">MEDAILE</h3>
  <div id="medals-container"></div>
</div>

<!-- Nastaven√≠ rozsahu pro randomNeed -->
<div id="settings-bar" style="margin:10px 0 24px 0; text-align:center;">
  <div id="settings-btn" style="cursor:pointer; display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:0px solid #333; border-radius:10px; background:#fff;">
    <span style="font-size:20px;">‚öô</span>
  </div>

  <div id="settings-panel" style="display:none; margin-top:10px;">
    <label>Min: <input type="number" id="minValue" value="10" style="width:80px;"></label>
    &nbsp;&nbsp;
    <label>Max: <input type="number" id="maxValue" value="100" style="width:80px;"></label>
    &nbsp;&nbsp;
    <button id="saveRange" class="small">Ulo≈æit</button>
    <button id="cancelRange" class="small">Zav≈ô√≠t</button>
    <div id="rangeMsg" style="margin-top:6px; font-size:13px;"></div>
  </div>
</div>

<script>
function playSound(id){
  const el = document.getElementById(id);
  if(!el) return;
  el.currentTime = 0;
  el.play().catch(()=>{});
}

/* Celebration (ported from ABC) */
const GIF_COUNT = 16;   // dance1.gif ... dance16.gif
const MUSIC_COUNT = 10; // music1.mp3 ... music10.mp3
function showCelebration(){
  const box = document.getElementById('gif-container');
  const img = document.getElementById('gif-animation');
  const g = Math.floor(Math.random()*GIF_COUNT)+1;
  const m = Math.floor(Math.random()*MUSIC_COUNT)+1;
  img.src = `dance${g}.gif`;
  box.style.display = 'block';
  const audio = new Audio(`music${m}.mp3`);
  audio.volume = 1;
  audio.play()
    .then(()=> audio.addEventListener('ended', ()=>{ box.style.display='none'; }))
    .catch(()=>{ setTimeout(()=> box.style.display='none', 5000); });
}

/* ---------- DATA PENƒöZ ---------- */
const MONEY = [
  { v:1,  img:"MONEY/1_Koruna.png",  label:"1 Kƒç" },
  { v:2,  img:"MONEY/2_Koruna.png",  label:"2 Kƒç" },
  { v:5,  img:"MONEY/5_Koruna.png",  label:"5 Kƒç" },
  { v:10, img:"MONEY/10_Koruna.png", label:"10 Kƒç" },
  { v:20, img:"MONEY/20_Koruna.png", label:"20 Kƒç" },
  { v:50, img:"MONEY/50_Koruna.jpg", label:"50 Kƒç" },
  { v:100,img:"MONEY/100_Koruna.jpg",label:"100 Kƒç" },
  { v:200,img:"MONEY/200_Korun.jpg",label:"200 Kƒç" },
  { v:500,img:"MONEY/500_Korun.jpg",label:"500 Kƒç" },
  { v:1000,img:"MONEY/1000_Korun.jpg",label:"1000 Kƒç" }
];

/* ---------- STAV ---------- */
let need = 0;
let placed = [];  // seznam hodnot na stole
let scoreGood = 0, scoreBad = 0;
let minRange = 10;
let maxRange = 100;

/* ---------- ELEMENTY ---------- */
const moneyRow = document.getElementById('moneyRow');
const desk     = document.getElementById('desk');
const sumEl    = document.getElementById('sum');
const msg      = document.getElementById('msg');
const needEl   = document.getElementById('need');
const bubble   = document.getElementById('bubble');
const goodEl   = document.getElementById('good');
const badEl    = document.getElementById('bad');
const celebrate= document.getElementById('celebrate');
const reqIcon  = document.getElementById('reqIcon');
const basketEl = document.getElementById('basket');

const settingsBtn   = document.getElementById('settings-btn');
const settingsPanel = document.getElementById('settings-panel');
const minInput      = document.getElementById('minValue');
const maxInput      = document.getElementById('maxValue');
const saveRangeBtn  = document.getElementById('saveRange');
const cancelRangeBtn= document.getElementById('cancelRange');
const rangeMsg      = document.getElementById('rangeMsg');

/* ---------- UI ‚Äì vytvo≈ôen√≠ ≈ôady minc√≠ ---------- */
MONEY.forEach(m=>{
  const b = document.createElement('button');
  b.className = 'money-btn';
  b.title = m.label;
  b.innerHTML = `<img src="${m.img}" alt="${m.label}"><span>${m.label}</span>`;
  b.addEventListener('click',()=> addMoney(m));
  moneyRow.appendChild(b);
});

function addMoney(m){
  placed.push(m.v);
  const img = document.createElement('img');
  img.src = m.img; img.alt = m.label; img.className = 'removable';
  img.title = `${m.label} (klik = odebrat)`;
  img.addEventListener('click', ()=> removePiece(img, m.v));
  desk.appendChild(img);
  playSound('sound-correct');
  updateSum();
}

function removePiece(node, value){
  const idx = placed.indexOf(value);
  if(idx>-1){ placed.splice(idx,1); }
  node.remove();
  updateSum();
}

function updateSum(){
  const s = placed.reduce((a,b)=>a+b,0);
  sumEl.textContent = `${s} Kƒç`;
  msg.textContent = '';
  bubble.querySelector('.hint').textContent = 'Zapla≈•te pros√≠m';
}

/* ===========================================================
   TABULKA REALISTICK√ùCH CEN A PRODUKT≈Æ (3 mo≈ænosti v intervalu)
   Rozpƒõt√≠:
   - 10‚Äì50 po 5 Kƒç
   - 51‚Äì100 po 10 Kƒç
   - 101‚Äì500 po 50 Kƒç
   - 501‚Äì1000 po 100 Kƒç
   =========================================================== */
const PRICE_TABLE = [
  {min:10,max:15,  options:[
    {name:"Jablko", price:12, icon:"üçé"},
    {name:"Ban√°n",  price:13, icon:"üçå"},
    {name:"Su≈°enka",price:12, icon:"üç™"}
  ]},
  {min:16,max:20,  options:[
    {name:"Hru≈°ka", price:18, icon:"üçê"},
    {name:"Jogurt", price:19, icon:"ü•õ"},
    {name:"Tatranka",price:18,icon:"üç´"}
  ]},
  {min:21,max:25,  options:[
    {name:"Tyƒçinka",price:24, icon:"üç´"},
    {name:"Pomeranƒç",price:25,icon:"üçä"},
    {name:"Su≈°enka vƒõt≈°√≠",price:25,icon:"üç™"}
  ]},
  {min:26,max:30,  options:[
    {name:"Pl√°tek melounu",price:29,icon:"üçâ"},
    {name:"Zmrzlina (kopeƒçek)",price:28,icon:"üç®"},
    {name:"Donut",price:29,icon:"üç©"}
  ]},
  {min:31,max:35,  options:[
    {name:"Kef√≠r",price:33,icon:"ü•õ"},
    {name:"Kobliha",price:33,icon:"üç©"},
    {name:"Popcorn mal√Ω",price:35,icon:"üçø"}
  ]},
  {min:36,max:40,  options:[
    {name:"Taven√Ω s√Ωr",price:39,icon:"üßÄ"},
    {name:"D≈æus 0.3 l",price:39,icon:"üßÉ"},
    {name:"O≈ô√≠≈°ky mini",price:39,icon:"ü•ú"}
  ]},
  {min:41,max:45,  options:[
    {name:"P√°rek v rohl√≠ku",price:45,icon:"üå≠"},
    {name:"Bageta mal√°",price:45,icon:"ü•ñ"},
    {name:"ƒåokol√°da mal√°",price:44,icon:"üç´"}
  ]},
  {min:46,max:50,  options:[
    {name:"Pl√°tek pizzy",price:49,icon:"üçï"},
    {name:"Jahody 250 g",price:49,icon:"üçì"},
    {name:"Zmrzlina kel√≠mek",price:49,icon:"üç¶"}
  ]},
  {min:51,max:60,  options:[
    {name:"Caff√® latte",price:59,icon:"‚òï"},
    {name:"Jableƒçn√Ω mo≈°t 1 l",price:59,icon:"üßÉ"},
    {name:"S√Ωrov√© tyƒçinky",price:59,icon:"üßÄ"}
  ]},
  {min:61,max:70,  options:[
    {name:"M√°slo 250 g",price:65,icon:"üßà"},
    {name:"Eidam 200 g",price:69,icon:"üßÄ"},
    {name:"≈†unka 100 g",price:65,icon:"üçñ"}
  ]},
  {min:71,max:80,  options:[
    {name:"Granola 500 g",price:79,icon:"ü•£"},
    {name:"Olivy 300 g",price:75,icon:"ü´í"},
    {name:"Tortilly 6 ks",price:79,icon:"üåØ"}
  ]},
  {min:81,max:90,  options:[
    {name:"Bageta velk√°",price:89,icon:"ü•ñ"},
    {name:"Ku≈ôec√≠ nugety",price:89,icon:"üçó"},
    {name:"Dort√≠k",price:89,icon:"üç∞"}
  ]},
  {min:91,max:100, options:[
    {name:"ƒåokol√°da velk√°",price:99,icon:"üç´"},
    {name:"Hrozny 1 kg",price:99,icon:"üçá"},
    {name:"Kvƒõt√°k 1 ks",price:95,icon:"ü•¶"}
  ]},
  {min:101,max:150, options:[
    {name:"Obƒõd menu",price:129,icon:"üçõ"},
    {name:"S√Ωr camembert",price:129,icon:"üßÄ"},
    {name:"K√°va ‚Äì zrna 250 g",price:149,icon:"‚òï"}
  ]},
  {min:151,max:200, options:[
    {name:"Triko basic",price:199,icon:"üëï"},
    {name:"M√≠ƒç",price:179,icon:"‚öΩ"},
    {name:"V√≠no l√°hev",price:189,icon:"üç∑"}
  ]},
  {min:201,max:250, options:[
    {name:"Stavebnice mal√°",price:249,icon:"üß©"},
    {name:"Powerbanka 2500 mAh",price:249,icon:"üîã"},
    {name:"Sluch√°tka dr√°tov√°",price:229,icon:"üéß"}
  ]},
  {min:251,max:300, options:[
    {name:"Rodinn√° pizza",price:299,icon:"üçï"},
    {name:"Kuchy≈àsk√° v√°ha",price:299,icon:"‚öñÔ∏è"},
    {name:"ƒåteƒçka karet",price:279,icon:"üíæ"}
  ]},
  {min:301,max:350, options:[
    {name:"Mikina",price:349,icon:"üß•"},
    {name:"Batoh mal√Ω",price:349,icon:"üéí"},
    {name:"F√©n",price:329,icon:"üí®"}
  ]},
  {min:351,max:400, options:[
    {name:"Tenisky",price:399,icon:"üëü"},
    {name:"Mix√©r",price:399,icon:"‚öôÔ∏è"},
    {name:"Toaletn√≠ voda",price:399,icon:"üß¥"}
  ]},
  {min:401,max:450, options:[
    {name:"K√°vovar kapslov√Ω",price:449,icon:"‚òï"},
    {name:"Stavebnice st≈ôedn√≠",price:449,icon:"üß±"},
    {name:"Flash disk 128 GB",price:429,icon:"üíæ"}
  ]},
  {min:451,max:500, options:[
    {name:"Chytr√© hodinky basic",price:499,icon:"‚åö"},
    {name:"Dƒõtsk√° bunda",price:499,icon:"üß•"},
    {name:"Spoleƒçensk√° hra",price:479,icon:"üé≤"}
  ]},
  {min:501,max:600, options:[
    {name:"Tlaƒç√≠tkov√Ω telefon",price:599,icon:"üì±"},
    {name:"Koleƒçkov√© brusle",price:599,icon:"üõº"},
    {name:"Stoln√≠ lampa",price:549,icon:"üí°"}
  ]},
  {min:601,max:700, options:[
    {name:"Wi-Fi router",price:699,icon:"üì∂"},
    {name:"Mikrovlnka mal√°",price:699,icon:"üç≤"},
    {name:"Sluch√°tka BT",price:699,icon:"üéß"}
  ]},
  {min:701,max:800, options:[
    {name:"Tablet dƒõtsk√Ω",price:799,icon:"üì±"},
    {name:"K√°vovar p√°kov√Ω",price:799,icon:"‚òï"},
    {name:"Mix√©r v√Ωkonn√Ω",price:799,icon:"üåÄ"}
  ]},
  {min:801,max:900, options:[
    {name:"Robotick√Ω vysavaƒç",price:899,icon:"ü§ñ"},
    {name:"Zimn√≠ pneu 1 ks",price:899,icon:"üõû"},
    {name:"Monitor 22‚Ä≥",price:899,icon:"üñ•Ô∏è"}
  ]},
  {min:901,max:1000, options:[
    {name:"Telefon basic",price:999,icon:"üì±"},
    {name:"Mikrovƒõ≈æ",price:999,icon:"üìª"},
    {name:"Hern√≠ ovladaƒç",price:999,icon:"üéÆ"}
  ]}
];

function findRange(val){
  return PRICE_TABLE.find(r => val>=r.min && val<=r.max) || null;
}
function pickProduct(val){
  const r = findRange(val);
  if(!r) return {name:"Ko≈°√≠k", price:val, icon:"üõí"};
  const i = Math.floor(Math.random()*r.options.length);
  return r.options[i];
}
function showRequestProduct(val){
  const p = pickProduct(val);
  reqIcon.innerHTML = '';
  const span = document.createElement('span');
  span.className = 'icon-emoji big';
  span.textContent = p.icon;
  reqIcon.appendChild(span);
  // ulo≈æit pro p≈ôesun do ko≈°e
  reqIcon.dataset.icon = p.icon;
  reqIcon.dataset.name = p.name;
  reqIcon.title = `${p.name} ‚Äì ~${p.price} Kƒç`;
}
function moveIconToBasket(){
  const icon = reqIcon.dataset.icon;
  const name = reqIcon.dataset.name || '';
  if(!icon) return; // nic k p≈ôesunu
  const piece = document.createElement('span');
  piece.className = 'icon-emoji';
  piece.textContent = icon;
  piece.title = name;
  basketEl.appendChild(piece);
  // vyƒçisti box
  reqIcon.innerHTML = '';
  delete reqIcon.dataset.icon;
  delete reqIcon.dataset.name;
}

/* ---------- N√°hodn√° ƒç√°stka ---------- */
function randomNeed(){
  const span = maxRange - minRange + 1;
  if (span < 1) { minRange = 10; maxRange = 100; }
  need = Math.floor(Math.random() * (maxRange - minRange + 1)) + minRange;
  needEl.textContent = `${need} Kƒç`;
  showRequestProduct(need); // NOVƒö: zobraz ikonku dle intervalu
}

/* ---------- Nastaven√≠ rozsahu ---------- */
settingsBtn.addEventListener('click', () => {
  minInput.value = minRange;
  maxInput.value = maxRange;
  rangeMsg.textContent = '';
  settingsPanel.style.display = settingsPanel.style.display === 'none' ? 'block' : 'none';
});
cancelRangeBtn.addEventListener('click', () => { settingsPanel.style.display = 'none'; });
saveRangeBtn.addEventListener('click', () => {
  const newMin = parseInt(minInput.value, 10);
  const newMax = parseInt(maxInput.value, 10);
  if (Number.isNaN(newMin) || Number.isNaN(newMax)) { rangeMsg.style.color = 'var(--red)'; rangeMsg.textContent = 'Zadej pros√≠m ƒç√≠sla.'; return; }
  if (newMin < 0) { rangeMsg.style.color = 'var(--red)'; rangeMsg.textContent = 'Min nesm√≠ b√Ωt z√°porn√©.'; return; }
  if (newMax < newMin) { rangeMsg.style.color = 'var(--red)'; rangeMsg.textContent = 'Max mus√≠ b√Ωt ‚â• Min.'; return; }
  minRange = newMin; maxRange = newMax;
  rangeMsg.style.color = 'var(--green)'; rangeMsg.textContent = `Rozsah ulo≈æen (${minRange}‚Äì${maxRange}).`;
  randomNeed();
  setTimeout(() => { settingsPanel.style.display = 'none'; }, 400);
});

/* ---------- Reset stolu ---------- */
function resetDesk(){
  placed = [];
  desk.innerHTML = '';
  updateSum();
}

/* ---------- HRA ---------- */
document.getElementById('payBtn').addEventListener('click', ()=>{
  const total = placed.reduce((a,b)=>a+b,0);
  if(total === need){
    scoreGood++; goodEl.textContent = scoreGood;
    msg.style.color = 'var(--green)'; msg.textContent = 'Spr√°vnƒõ! Dƒõkuji.';
    playSound('sound-win');
    launchFireworks();
    maybeCelebrate(scoreGood);
    if (scoreGood % 5 === 0) addMedal('bronze');

    /* D≈ÆLE≈ΩIT√â PO≈òAD√ç:
       1) p≈ôesunout aktu√°ln√≠ ikonku do ko≈°√≠ku,
       2) vyƒçistit st≈Øl,
       3) vygenerovat novou ƒç√°stku (ta zobraz√≠ novou velkou ikonku)
    */
    moveIconToBasket();   // ‚Üê nejd≈ô√≠v p≈ôesun
    resetDesk();          // vypr√°zdnit pen√≠ze na stole
    randomNeed();         // nov√° ƒç√°stka + nov√° ikona

    setTimeout(()=>{ stopFireworks(); }, 1600);
    updateMedals();
  }else{
    scoreBad++; badEl.textContent = scoreBad;
    playSound('sound-wrong');
    if(total < need){
      msg.style.color = 'var(--red)'; msg.textContent = 'M√°lo!';
      bubble.querySelector('.hint').textContent = 'Je to m√°lo‚Ä¶';
    }else{
      msg.style.color = 'var(--red)'; msg.textContent = 'Moc!';
      bubble.querySelector('.hint').textContent = 'Je to moc‚Ä¶';
    }
  }
});

document.getElementById('clearBtn').addEventListener('click', resetDesk);
document.getElementById('undoBtn').addEventListener('click', ()=>{
  if(!desk.lastElementChild) return;
  const lastImg = desk.lastElementChild;
  lastImg.click(); // vyu≈æije handler odebr√°n√≠
});

/* ---------- Start ---------- */
randomNeed();

/* ---------- OSLAVA ‚Äì ka≈æd√Ωch 5 bod≈Ø ---------- */
function maybeCelebrate(score){
  if(score>0 && score % 5 === 0){
    showCelebration();
  }
}

/* ---------- OH≈áOSTROJ (canvas) ---------- */
const fwCanvas = document.getElementById('fw');
const fctx = fwCanvas.getContext('2d');
let fwTimer=null, rockets=[];
function sizeCanvas(){ fwCanvas.width = innerWidth; fwCanvas.height = innerHeight; }
addEventListener('resize', sizeCanvas); sizeCanvas();
function createFirework(){
  const x = Math.random()*fwCanvas.width;
  const y = Math.random()*fwCanvas.height*0.4+40;
  const colors=['#ff3b3b','#33cc33','#3399ff','#ffd166','#ff66cc','#00ffff'];
  const color=colors[(Math.random()*colors.length)|0];
  const parts=[];
  for(let i=0;i<40;i++){
    const ang=Math.random()*Math.PI*2;
    const sp = Math.random()*5+2;
    parts.push({x,y,dx:Math.cos(ang)*sp,dy:Math.sin(ang)*sp,alpha:1,col:color});
  }
  return {parts};
}
function launchFireworks(){
  sizeCanvas();
  rockets = [];
  for(let i=0;i<5;i++) rockets.push(createFirework());
  if(fwTimer) clearInterval(fwTimer);
  fwTimer = setInterval(updateFW, 50);
}
function stopFireworks(){
  clearInterval(fwTimer); fwTimer=null;
  rockets=[]; fctx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
}
function updateFW(){
  fctx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
  rockets.forEach(r=>{
    r.parts.forEach(p=>{ p.x+=p.dx; p.y+=p.dy; p.alpha-=0.02; });
    r.parts = r.parts.filter(p=>p.alpha>0);
    r.parts.forEach(p=>{
      fctx.beginPath(); fctx.arc(p.x,p.y,3,0,2*Math.PI);
      fctx.fillStyle = p.col; fctx.globalAlpha = p.alpha; fctx.fill();
    });
  });
  fctx.globalAlpha=1;
}

/* ===== Medaile & poh√°ry ‚Äì jako v ABC ===== */
const medals = { bronze:0, silver:0, gold:0, trophy:0 };
function updateMedals(){
  const c = document.getElementById('medals-container');
  c.innerHTML = '';
  for(let i=0;i<medals.trophy;i++) addIcon('üèÜ','trophy');
  for(let i=0;i<medals.gold;i++)   addIcon('ü•á','gold');
  for(let i=0;i<medals.silver;i++) addIcon('ü•à','silver');
  for(let i=0;i<medals.bronze;i++) addIcon('ü•â','bronze');
  function addIcon(char, cls){
    const s=document.createElement('span');
    s.className='medal '+cls;
    s.textContent=char;
    c.appendChild(s);
  }
}
function popMedal(char){
  const m = document.getElementById('medal-animation');
  m.textContent = char;
  m.style.display='block';
  m.style.top='50%';
  m.style.animation='medal-from-depth 0.6s ease-out';
  document.body.appendChild(m);
  document.getElementById('sound-metal-fall')?.play().catch(()=>{});
  setTimeout(()=>{ m.style.display='none'; m.style.animation=''; m.style.top='-100px'; }, 650);
}
function flashMerge(){
  const f=document.createElement('div');
  f.className='flash-effect';
  document.body.appendChild(f);
  setTimeout(()=>f.remove(),520);
  document.getElementById('sound-metal-fuse')?.play().catch(()=>{});
}
function addMedal(type){
  medals[type]++; updateMedals();
  tryMerge(type);
}
function tryMerge(type){
  const next = { bronze:'silver', silver:'gold', gold:'trophy' }[type] || null;
  if(!next) return;
  if(medals[type] >= 3){
    medals[type] -= 3;
    medals[next] += 1;
    flashMerge();
    updateMedals();
    document.querySelectorAll('.medal.'+next).forEach(el=>{
      el.classList.add('shake');
      setTimeout(()=>el.classList.remove('shake'),550);
    });
    popMedal(next==='silver'?'ü•à':next==='gold'?'ü•á':'üèÜ');
    tryMerge(next);
  }else{
    const last = [...document.querySelectorAll('.medal.'+type)].pop();
    if(last){ last.classList.add('pop-in'); setTimeout(()=>last.classList.remove('pop-in'),220); }
    popMedal(type==='bronze'?'ü•â':type==='silver'?'ü•à':'ü•á');
  }
}
</script>
</body>
</html>
